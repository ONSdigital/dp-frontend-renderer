<div class="page-intro background--gallery">
    <div class="wrapper">
        <div class="col-wrap">
            <div class="col">
                {{ template "partials/breadcrumb" . }}
                <h1 class="page-intro__title margin-bottom--4">
                    <span class="page-intro__type">Dataset</span>
                    {{ .Metadata.Title }}
                </h1>
            </div>
        </div>
    </div>
</div>
{{ if or .DatasetLandingPage.Corrections .DatasetLandingPage.Notices }}
<div class="background--abbey padding-top--3 padding-bottom--3">
    <div class="wrapper">
        <div class="col-wrap">
            <div class="col">
                <div class="js-show-hide show-hide show-hide--dark info-box">
                    <div class="js-show-hide__title">
                        <h2 class="show-hide__title padding-left-sm--1 padding-left-md--4">
                            <span class="icon icon-info icon-info--info-box hide--sm"></span>
                            {{ if and .DatasetLandingPage.Corrections .DatasetLandingPage.Notices }}
                                Corrections and notices
                            {{else if .DatasetLandingPage.Corrections}}
                                Correction{{ if (gt (len .DatasetLandingPage.Corrections) 1) }}s{{ end }}
                            {{else if .DatasetLandingPage.Notices}}
                                Notice{{ if (gt (len .DatasetLandingPage.Notices) 1) }}s{{ end }}
                            {{ end }}
                        </h2>
                    </div>
                    <div class="js-show-hide__content">
                        {{ if .DatasetLandingPage.Corrections}}
                            <div class="show-hide__content alert--warning__content section__content--markdown padding-bottom--1">
                                {{ if .DatasetLandingPage.Notices }}
                                    <h3>Corrections</h3>
                                {{ end }}
                                <section>
                                    {{ range .DatasetLandingPage.Corrections }}
                                        <p class="alert__date">{{ dateFormat .Date }}</p>
                                        {{ .Markdown }}
                                    {{ end }}
                                </section>
                            </div>
                        {{ end }}

                        {{ if .DatasetLandingPage.Notices}}
                            <div class="show-hide__content alert--warning__content section__content--markdown padding-bottom--1">
                                {{ if .DatasetLandingPage.Corrections }}
                                    <h3>Notices</h3>
                                {{ end }}
                                <section>
                                    {{ range .DatasetLandingPage.Notices }}
                                        <p class="alert__date">{{ dateFormat .Date }}</p>
                                        {{ .Markdown }}
                                    {{ end }}
                                </section>
                            </div>
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}

<div class="meta-wrap">
    <div class="wrapper">
        <dl class="col-wrap">
            <div class="col col--md-12 col--lg-15 meta__item">
                {{ if .DatasetLandingPage.IsNationalStatistic}}
                    <a href="https://www.statisticsauthority.gov.uk/national-statistician/types-of-official-statistics/">
                        <img class="meta__image" src="/img/national-statistics.png" alt="National Statistics logo">
                    </a>
                {{ end }}
                <dt class="meta__term">Contact:</dt>
                <dd>
                    {{ if .ContactDetails.Email}}
                        <a href="mailto:{{ .ContactDetails.Email}}">{{ .ContactDetails.Name }}</a>
                    {{ else }}
                        {{ .ContactDetails.Name }}
                    {{ end }}
                </dd>
            </div>
            <div class="col col--md-12 col--lg-15 meta__item">
                <dt class="meta__term">Release date:</dt>
                <dd>{{ dateFormat .DatasetLandingPage.ReleaseDate }}</dd>
            </div>
            <div class="col col--md-12 col--lg-15 meta__item">
                <dt class="meta__term">Next release:</dt>
                <dd>
                    {{ if .DatasetLandingPage.NextRelease }}
                        {{ .DatasetLandingPage.NextRelease }}
                    {{ else }}
                        To be announced
                    {{ end }}
                </dd>
            </div>
            {{ if .DatasetLandingPage.DatasetID}}
                <div class="col col--md-12 col--lg-15 meta__item">
                    <dt class="meta__term">Dataset ID:</dt>
                    <dd>{{ .DatasetLandingPage.DatasetID }}</dd>
                </div>
            {{ end }}
        </dl>
    </div>
</div>

<div class="wrapper">
        <div class="col-wrap margin-bottom--4">
            <div class="col col--lg-two-thirds col--md-two-thirds">
                {{ if .Metadata.Description}}
                    <section>
                        <h2>About this dataset</h2>
                        {{ .Metadata.Description }}
                    </section>
                {{ end }}
                <section>
                    {{ if .DatasetLandingPage.Related.FilterableDatasets }}
                        <div class="status status--blue margin-top--6">
                            <p class="margin-top--0">Try the new way to filter and download this data:</p>
                            <ul class="list--neutral margin-bottom--0">
                                {{ range .DatasetLandingPage.Related.FilterableDatasets }}
                                    <li> <a href="{{ .URI }}">{{ .Title }}</a></li>
                                {{ end }}
                            </ul>
                        </div>
                    {{ end }}
                    <h2 class="margin-bottom--2">Your download options</h2>
                    {{ if .DatasetLandingPage.IsTimeseries }}
                        {{ $timeseriesDataset := index .DatasetLandingPage.Datasets 0 }}
                        {{ range $timeseriesDataset.Downloads }}
                            <div class="inline-block--md margin-bottom-sm--1">
                                <a href="{{ legacyDatasetDownloadURI $timeseriesDataset.URI .URI }}" class="btn btn--primary btn--thick">
                                    <span class="visuallyhidden">Download {{ $.Metadata.Title }} in {{ .Extension }} format</span>
                                    {{ if eq .Extension "csdb" }}
                                        structured text ({{ humanSize .Size }})
                                    {{ else }}
                                        {{ .Extension }} ({{ humanSize .Size }})
                                    {{ end }}
                                </a>
                            </div>
                        {{ end }}
                        {{ if $timeseriesDataset.HasVersions }}
                            <p class="margin-top--0">
                                <span class="icon icon-info--inline"></span>
                                <a href="{{ $timeseriesDataset.URI }}" class="underline-link margin-left--3">Previous versions</a> of this data are available.
                            </p>
                        {{ end }}
                        {{ if $timeseriesDataset.SupplementaryFiles }}
                            <h4 class="margin-bottom--0">Supporting files you may find useful</h4>
                            <ul class="list--neutral margin-top--0">
                                {{ range $timeseriesDataset.SupplementaryFiles }}
                                    <li class="margin-top--0 margin-bottom--0">
                                        <a href="/file?uri={{ $timeseriesDataset.URI }}/{{ .URI }}">{{ .Title }}</a>
                                        <span class="uppercase">({{ .Extension }}, {{ humanSize .Size }})</span>
                                    </li>
                                {{ end }}
                            </ul>
                        {{ end }}
                    {{else}}
                        {{ range $key, $value := .DatasetLandingPage.Datasets }}
                            {{ $dataset := . }}
                            <div class="show-hide show-hide--light js-show-hide border-top--abbey-sm border-top--abbey-md border-top--abbey-lg{{if .IsLast}} border-bottom--abbey-sm border-bottom--abbey-md border-bottom--abbey-lg{{end}}">
                                <div class="js-show-hide__title{{if eq $key 0}} is-shown{{end}}">
                                    <h3 class="margin-top--0 margin-bottom--0">{{ $dataset.Title }}</h3>
                                </div>
                                <div class="js-show-hide__content">
                                    <div class="margin-bottom--2">
                                        {{ range .Downloads }}
                                            <div class="inline-block--md margin-bottom-sm--1">
                                                <a href="/file?uri={{ $dataset.URI }}/{{ .URI }}" class="btn btn--primary btn--thick">
                                                    <span class="visuallyhidden">Download {{$.Metadata.Title}}: {{$dataset.Title}} in {{ .Extension }} format</span>
                                                    {{ if eq .Extension "csdb" }}
                                                        structured text ({{ humanSize .Size }})
                                                    {{ else }}
                                                        <span>{{ .Extension }} ({{ humanSize .Size }})</span>
                                                    {{ end }}
                                                </a>
                                            </div>
                                        {{ end }}
                                    </div>
                                    {{ if .HasVersions }}
                                        <p class="margin-top--0">
                                            <span class="icon icon-info--inline"></span>
                                            <a href="{{ .URI }}" class="underline-link margin-left--3">Previous versions</a> of this data are available.
                                        </p>
                                    {{ end }}
                                    {{ if .SupplementaryFiles }}
                                        <h4 class="margin-bottom--0">Supporting files you may find useful</h4>
                                        <ul class="list--neutral margin-top--0">
                                            {{ range .SupplementaryFiles }}
                                                <li class="margin-top--0 margin-bottom--0">
                                                    <a href="/file?uri={{ $dataset.URI }}/{{ .URI }}">{{ .Title }}</a>
                                                    <span class="uppercase">({{ .Extension }}, {{ humanSize .Size }})</span>
                                                </li>
                                            {{ end }}
                                        </ul>
                                    {{ end }}
                                </div>
                            </div>
                        {{ end }}
                    {{ end }}
                </section>

                {{ if .DatasetLandingPage.Notes}}
                    <section>
                        <h2>Important notes and usage information</h2>
                        <div class="section__content--static-markdown margin-top-sm--2 margin-top-md--3">
                            {{ .DatasetLandingPage.Notes | markdown }}
                        </div>
                    </section>
                {{ end }}

            </div>
            <div class="col col--lg-one-third col--md-one-third margin-top margin-bottom">

                <div class="print--hide margin-bottom--2">
                    <a href="../datalist?filter=datasets" class="btn btn--primary btn--full-width">View all data related to <span class="lowercase">{{ .DatasetLandingPage.ParentPath }}</span></a>
                </div>

                <div class="tiles__item tiles__item--nav-type margin-left--0 margin-right--0">
                    <h3 class="tiles__title-h3 tiles__title-h3--nav">Contact details for this dataset</h3>
                    <div class="tiles__content tiles__content--nav">
                        <address>
                            {{ if .ContactDetails.Name}}
                                {{ .ContactDetails.Name }}
                            {{ end }}
                            {{ if .ContactDetails.Email}}
                                <br>
                                <a href="mailto:{{ .ContactDetails.Email}}">{{ .ContactDetails.Email }}</a>
                            {{ end }}
                            {{ if .ContactDetails.Telephone }}
                                <br>
                                {{ .ContactDetails.Telephone }}
                            {{ end }}
                        </address>
                    </div>
                </div>

                {{ if .DatasetLandingPage.Related.Publications }}
                    <div class="tiles__item tiles__item--nav-type margin-left--0 margin-right--0">
                        <h3 class="tiles__title-h3 tiles__title-h3--nav">Publications that use this data</h3>
                        <div class="tiles__content tiles__content--nav">
                            <ul class="list--neutral">
                                {{ range .DatasetLandingPage.Related.Publications }}
                                    <li><a href="{{ .URI }}">{{ .Title }}</a></li>
                                {{ end }}
                            </ul>
                        </div>
                    </div>
                {{ end }}

                {{ if .DatasetLandingPage.Related.Methodology }}
                    <div class="tiles__item tiles__item--nav-type margin-left--0 margin-right--0">
                        <h3 class="tiles__title-h3 tiles__title-h3--nav">Methodology</h3>
                        <div class="tiles__content tiles__content--nav">
                            <ul class="list--neutral">
                                {{ range .DatasetLandingPage.Related.Methodology }}
                                    <li><a href="{{ .URI }}">{{ .Title }}</a></li>
                                {{ end }}
                            </ul>
                        </div>
                    </div>
                {{ end }}

                {{ if .DatasetLandingPage.Related.Links }}
                    <div class="tiles__item tiles__item--nav-type margin-left--0 margin-right--0">
                        <h3 class="tiles__title-h3 tiles__title-h3--nav">Related links</h3>
                        <div class="tiles__content tiles__content--nav">
                            <ul class="list--neutral">
                                {{ range .DatasetLandingPage.Related.Links }}
                                    <li><a href="{{ .URI }}">{{ .Title }}</a></li>
                                {{ end }}
                            </ul>
                        </div>
                    </div>
                {{ end }}
            </div>
        </div>
    </div>
