{{ template "partials/loop11" . }}
<div class="page-intro">
  <div class="wrapper">
      <div class="col-wrap">
        <div class="col">
            {{ template "partials/breadcrumb" . }}
            <div class="col col--md-47 col--lg-58">
              <h1 class="page-intro__title margin-bottom--1">
                {{if not .NoDimensionData}}<span class="font-size--21 line-height--30 page-intro__type padding-top--0 padding-bottom--0">{{.DatasetTitle}}: {{.Data.Edition}}</span>{{end}}
                <strong id="page-title">{{if not .NoDimensionData}}Filtered dataset{{else}}We can't create a preview{{end}}</strong>
              </h1>
            </div>
        </div>
      </div>
  </div>
</div>
<div class="adjust-font-size--16">
   <div class="page-content link-adjust">
      <div class="wrapper">
         <div class="col-wrap">
            <div class="col">
              {{if not .NoDimensionData}}
              {{if not .Data.IsLatestVersion}}
              <div class="alert margin-bottom--2 padding-right--1 padding-left--1">
                <div class="alert__title">This is not the latest release</div>
                <a class="btn btn--primary" href="{{.Data.LatestVersion.FilterJourneyWithLatestJourney}}"><strong>Apply these filters to the latest release</a>
                <a class="alert__link padding-left-md--1" href="{{.Data.LatestVersion.DatasetLandingPageURL}}">View latest release</a>
              </div>
              {{ end }}
              <a id="adjust-filter-options" href="/filters/{{.Data.FilterID}}/dimensions"><span class="icon icon-arrow-back--dark-small"></span>Adjust filter options</a>
              <h2><strong>Preview</strong></h2>
              <div class="table-border margin-top--3">
                <ul class="list--neutral margin-bottom--3">
                  <li class="margin-top--0 margin-bottom--1"><span class="inline-block width--10">Title</span>{{.DatasetTitle}}</li>
                  <li class="margin-top--0 margin-bottom--1"><span class="inline-block width--10">Dataset ID</span>{{.Data.DatasetID}}</li>
                  <li class="margin-top--0 margin-bottom--1"><span class="inline-block width--10">Release date</span>{{dateFormat .ReleaseDate}}</li>
                  {{range .Data.SingleValueDimensions}}
                    <li class="margin-top--0 margin-bottom--1"><span class="inline-block width--10">{{.Name}}</span>{{ index .Values 0 }}</li>
                  {{end}}
                </ul>
                {{if not .IsPreviewLoaded}}
                <meta http-equiv="refresh" content="2"/>
                <div class="border-top--gallery-sm border-top--gallery-md border-top--gallery-lg padding-top--2">
                    {{ template "partials/spinner" }}
                  <p class="margin-top--0 padding-top--0 height--8">Please wait whle we generate your preview and files...</p>
                </div>

                {{ else }}
                <div class="table-preview">
                    <table>
                      <thead>
                          <tr>
                            {{ range .Data.Dimensions }}
                            <th scope="col">{{.Name}}</th>
                            {{ end }}
                          </tr>
                      </thead>
                      <tbody>
                          {{ $dimensions := .Data.Dimensions }}
                          {{ range $i, $v := loop 0 (len (index $dimensions 0).Values ) }}
                          <tr>
                            {{ range $j, $dimension := $dimensions }}
                            <td>{{ index $dimension.Values $i }}</td>
                            {{ end }}
                          </tr>
                          {{ end }}
                      </tbody>
                    </table>
                    {{if eq (len (index .Data.Dimensions 0).Values) 10}}<p>Displaying the first 10 rows only</p>{{end}}
                </div>
               </div>
               {{if not .IsDownloadLoaded}}
              <meta http-equiv="refresh" content="2"/>
		 					<div class="border-top--gallery-sm border-top--gallery-md border-top--gallery-lg padding-top--2">
		 						{{ template "partials/spinner" }}
		 						<p class="margin-top--0 padding-top--0 height--8">Please wait whle we generate your files...</p>
		 					 </div>

		 					{{ else }}
               <h2><strong>Download</strong></h2>
               <div class="margin-bottom--2 margin-top--2">
                  {{ range .Data.Downloads}}
                  {{if not (eq .Size "") }}
                    {{if eq .Extension "xls"}}<a id="excel-download" class="btn btn--primary btn--thick margin-bottom--4 btn--focus font-size--19" href="{{.URI}}"><strong>Excel file</strong> <span class="font-size--14">({{ humanSize .Size }})</span></a>{{end}}
                  {{end}}
                  {{ end }}
                  <div class="margin-top--2 js-show-hide show-hide show-hide--light show-hide--dark-bg border-top--iron-sm border-top--iron-md border-bottom--iron-sm border-bottom--iron-md col--lg-two-thirds col--md-two-thirds">
                    <div class="js-show-hide__title show-hide__title show-hide__title--link-style margin-top--0 margin-bottom--0 padding-left--1 padding-right--0">
                      <button class="js-show-hide__button js-show-hide__button--slim" type="button" aria-expanded="false" aria-controls="collapsible-0">
                        <h3 class="margin-top--0 underline-link font-size--17">Other download options</h3>
                      </button>
                    </div>
                    <div class="js-show-hide__content show-hide__content padding-top--1 padding-right--1 padding-left--1">
                      <div class="margin-bottom--2">
                        <ul class="list--neutral">
                        {{range $i, $download := $.Data.Downloads}}
                          {{if ne $download.Extension "xls"}}{{if gt (len $download.Size) 0}}<li class="padding-left--1 margin-top--0 margin-bottom--1 white-background clearfix"><span class="inline-block width--24 padding-top--2">{{if eq $download.Extension "txt"}}Supporting information{{else}}Filtered dataset{{end}} (<span class="uppercase">{{$download.Extension}}</span> format)</span>
                          <div class="width--12 inline-block float-right text-right"><a id="{{$download.Extension}}-download" class="btn btn--primary margin-top--1 margin-bottom--1 margin-right--half width--11" href="{{$download.URI}}"><strong>{{$download.Extension}}</strong> ({{humanSize $download.Size}})</a></div></li>{{end}}{{end}}
                        {{end}}
                        </ul>
                      </div>
                    </div>
                  </div>
               </div>
                <p>Refer to the <a id="dataset-page-link" href="{{.Data.LatestVersion.DatasetLandingPageURL}}">dataset page</a> for more information on this data or to download the complete dataset.</p>
               {{end}}
               {{end}}
               {{else}}
               <div class="alert alert--light">
                 <p class="margin-bottom--half padding-bottom--0">Your selection were too specific, so there is no data to display</p>
                 <a class="inline-block margin-bottom--half" href="/filters/{{.Data.FilterID}}/dimensions">Please go back and adjust filter options</a>
               </div>
               {{end}}
            </div>
         </div>
      </div>
   </div>
</div>
